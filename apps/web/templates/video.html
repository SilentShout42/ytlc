{% extends "base.html" %}

{% block title %}{{ video.title }} - YTLC{% endblock %}

{% block extra_css %}
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-3.8.2.min.css" rel="stylesheet" type="text/css">
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.8.2.min.css" rel="stylesheet" type="text/css">
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.8.2.min.css" rel="stylesheet" type="text/css">
{% endblock %}

{% block extra_js %}
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-api-3.8.2.min.js"></script>
<script>
// YouTube Player initialization
var player;
var videoIdToLoad = '{{ video.video_id }}';

// Load YouTube IFrame Player API
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// This function is called by the YouTube API when it's ready
function onYouTubeIframeAPIReady() {
    player = new YT.Player('youtube-player', {
        height: '480',
        width: '100%',
        videoId: videoIdToLoad,
        playerVars: {
            'playsinline': 1
        },
        events: {
            'onReady': onPlayerReady
        }
    });
}

function onPlayerReady(event) {
    console.log('YouTube player ready with video: ' + videoIdToLoad);
}
</script>
{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="/" class="btn btn-secondary">&larr; Back to Videos</a>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h1 class="card-title">{{ video.title }}</h1>
        <p class="card-text">
            <strong>Date:</strong> {{ video.date }}<br>
            <strong>Video ID:</strong> {{ video.video_id }}<br>
            <strong>YouTube Link:</strong> <a href="https://www.youtube.com/watch?v={{ video.video_id }}" target="_blank">Watch on YouTube</a>
        </p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h2 class="card-title">Video Player</h2>
        <div class="ratio ratio-16x9">
            <div id="youtube-player"></div>
        </div>
        <p class="text-muted mt-2 mb-0"><small>Click on the chart bars below to jump to that time in the video</small></p>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h2 class="card-title">Chat Activity</h2>
        {% if plot_div %}
        <div class="plot-container">
            {{ plot_div|safe }}
        </div>
        {% else %}
        <div class="alert alert-info" role="alert">
            No chat data available for this video.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block plot_script %}
{% if plot_script %}
{{ plot_script|safe }}
{% endif %}
{% endblock %}
