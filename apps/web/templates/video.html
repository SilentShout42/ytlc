{% extends "base.html" %}

{% block title %}{{ video.title }} - YTLC{% endblock %}

{% block extra_css %}
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-3.8.2.min.css" rel="stylesheet" type="text/css">
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.8.2.min.css" rel="stylesheet" type="text/css">
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.8.2.min.css" rel="stylesheet" type="text/css">
<style>
    .video-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.1rem;
    }
    .video-date {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 0.75rem;
    }
    .plot-container {
        margin-top: 0;
    }
    .plot-container .bk-root {
        margin: 0;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.8.2.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-api-3.8.2.min.js"></script>
<script>
// YouTube Player initialization
var player;
var videoIdToLoad = '{{ video.video_id }}';

// Load YouTube IFrame Player API
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// This function is called by the YouTube API when it's ready
function onYouTubeIframeAPIReady() {
    player = new YT.Player('youtube-player', {
        height: '480',
        width: '100%',
        videoId: videoIdToLoad,
        playerVars: {
            'playsinline': 1
        },
        events: {
            'onReady': onPlayerReady
        }
    });
}

function onPlayerReady(event) {
    console.log('YouTube player ready with video: ' + videoIdToLoad);
}
</script>
{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="/" class="btn btn-secondary">&larr; Back to Videos</a>
</div>

<div class="video-title">{{ video.title }}</div>
<div class="video-date">{{ video.date }}</div>

<div class="ratio ratio-16x9">
    <div id="youtube-player"></div>
</div>

{% if plot_div %}
<div class="plot-container">
    {{ plot_div|safe }}
</div>
{% else %}
<div class="alert alert-info" role="alert">
    No chat data available for this video.
</div>
{% endif %}

<div class="form-check mt-2">
    <input
        class="form-check-input"
        type="checkbox"
        id="exclude-global-top"
        {% if exclude_global_top_emoji %}checked{% endif %}
        onchange="window.location='{{ url_for('video_detail', video_id=video.video_id) }}?exclude_global_top=' + (this.checked ? '1' : '0')"
    >
    <label class="form-check-label" for="exclude-global-top">
        Exclude the most used emoji for the full stream
        {% if global_top_emoji_url %}
        <img
            src="{{ global_top_emoji_url }}"
            alt="{{ global_top_emoji }}"
            style="height: 1.1em; width: 1.1em; margin-left: 0.35rem; vertical-align: -0.1em;"
        >
        {% endif %}
    </label>
</div>
{% endblock %}

{% block plot_script %}
{% if plot_script %}
{{ plot_script|safe }}
{% endif %}
{% endblock %}
